<div class="container">
  <div class="header-section">
    <h1><%= @product.display_name %></h1>
    <div class="header-actions">
      <%= link_to "Edit", edit_product_path(@product), class: "btn" %>
      <% if current_user.admin? %>
        <%= button_to "Delete", product_path(@product), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "btn" %>
      <% end %>
      <%= link_to "Back to Inventory", products_path, class: "btn" %>
    </div>
  </div>

  <div class="product-details">
    <div class="product-main">
      <div class="product-images">
        <% if @product.images.attached? %>
          <div class="images-header">
            <h3>Product Images (<%= @product.images.count %>)</h3>
          </div>
          <div class="images-grid">
            <% @product.images.each_with_index do |image, index| %>
              <div class="product-image-item">
                <div class="image-wrapper">
                  <%= image_tag image, style: "width: 100%; height: 250px; object-fit: cover; border-radius: 8px;" %>
                  <div class="image-overlay">
                    <span class="image-number"><%= index + 1 %></span>
                    <% if current_user.admin? %>
                      <%= button_to "Remove", remove_image_product_path(@product, image_id: image.id), 
                                    method: :delete, 
                                    class: "btn btn-sm remove-btn", 
                                    data: { turbo_confirm: "Remove this image?" } %>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="no-image">
            <i class="fas fa-image"></i>
            <p>No images uploaded</p>
          </div>
        <% end %>
      </div>

      <div class="product-info">
        <h2>Product Information</h2>
        <table class="detail-table">
          <tr><th>Category</th><td><%= @product.category.humanize %></td></tr>
          <tr><th>SKU</th><td><%= @product.sku %></td></tr>
          <tr><th>Serial Number</th><td><%= @product.serial_number %></td></tr>
          <tr><th>Status</th><td><span class="badge"><%= @product.status.humanize %></span></td></tr>
          <tr><th>Condition</th><td><span class="badge"><%= @product.condition.humanize %></span></td></tr>
          <tr><th>Brand</th><td><%= @product.brand %></td></tr>
          <tr><th>Model</th><td><%= @product.model %></td></tr>
          <tr><th>Model Number</th><td><%= @product.model_number %></td></tr>
          <tr><th>Vendor</th><td><%= @product.vendor %></td></tr>
          <tr><th>Location</th><td><%= @product.location %></td></tr>
          <tr><th>Purchase Date</th><td><%= @product.purchase_date %></td></tr>
          <tr><th>Purchase Price</th><td><%= format_currency(@product.purchase_price) if @product.purchase_price %></td></tr>
          <tr><th>Last Service Date</th><td><%= @product.last_service_date %></td></tr>
          <tr><th>Next Service Due</th><td><%= @product.next_service_due %></td></tr>
          <tr><th>Allocated To</th><td><%= @product.allocated_to&.name %></td></tr>
          <tr><th>Notes</th><td><%= simple_format(@product.notes) %></td></tr>
        </table>
      </div>
    </div>

    <div class="product-specific">
      <h2>Equipment Details</h2>
      <%= render partial: "products/specs", locals: { product: @product } %>
    </div>
  </div>
</div>

<style>
.container { max-width: 1100px; margin: 0 auto; padding: 20px; }
.header-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.header-actions { display: flex; gap: 10px; }
.product-details { display: grid; grid-template-columns: 2fr 1fr; gap: 18px; }
.product-main { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 18px; box-shadow: 0 3px 10px rgba(15,23,42,0.06); }
.product-images { margin-bottom: 16px; }
.images-header h3 { margin: 0 0 12px 0; font-size: 16px; color: var(--text); }
.images-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; }
.product-image-item { position: relative; }
.image-wrapper { position: relative; overflow: hidden; border-radius: 8px; }
.image-overlay { position: absolute; top: 8px; right: 8px; display: flex; gap: 6px; align-items: center; }
.image-number { background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; }
.remove-btn { background: rgba(220,38,38,0.9); color: white; border: none; padding: 4px 8px; font-size: 11px; border-radius: 4px; }
.remove-btn:hover { background: rgba(220,38,38,1); }
.no-image { text-align: center; padding: 40px 20px; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; color: #6c757d; }
.no-image i { font-size: 32px; margin-bottom: 8px; display: block; }
.product-info h2 { margin-top: 0; font-size: 18px; color: var(--text); }
.detail-table { width: 100%; border-collapse: collapse; }
.detail-table th { text-align: left; padding: 8px; background: #f7f7f8; width: 40%; font-weight: 600; color: var(--text); }
.detail-table td { padding: 8px; border-bottom: 1px solid var(--border); color: #374151; }
.badge { display: inline-flex; align-items: center; padding: 5px 9px; border-radius: 999px; font-size: 12px; font-weight: 600; background: rgba(45,138,117,0.10); color: var(--accent); border: 1px solid rgba(45,138,117,0.25); }
.product-specific { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 18px; box-shadow: 0 3px 10px rgba(15,23,42,0.06); }
</style>
