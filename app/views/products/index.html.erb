<div class="container">
  <div class="header-section">
    <h1>Inventory</h1>
    <%= link_to "Add New Product", new_product_path, class: "btn" %>
  </div>

  <div class="filters">
    <%= form_with url: products_path, method: :get, local: true, class: "filter-form" do |f| %>
      <div class="filter-group">
        <%= f.text_field :search, placeholder: "Search by name, SKU, serial, brand, model...", value: params[:search], class: "form-control" %>
        <%= f.select :category,
                     options_for_select([["All Categories", ""]] + Product.categories.keys.map { |c| [c.humanize, c] }, params[:category]),
                     {},
                     class: "form-control" %>
        <%= f.select :status,
                     options_for_select([["All Statuses", ""]] + Product.statuses.keys.map { |s| [s.humanize, s] }, params[:status]),
                     {},
                     class: "form-control" %>
        <%= f.submit "Filter", class: "btn" %>
        <%= link_to "Clear", products_path, class: "btn" %>
      </div>
    <% end %>
  </div>

  <div class="products-grid" id="product_notifications">
    <% if @products.any? %>
      <% @products.each do |product| %>
        <div class="product-card">
          <div class="product-image">
            <% if product.images.attached? %>
              <%= image_tag product.images.first.variant(resize_to_limit: [300, 200]), alt: product.display_name %>
            <% else %>
              <div class="no-image">No Image</div>
            <% end %>
          </div>

          <div class="product-info">
            <h3><%= link_to product.display_name, product_path(product) %></h3>
            <div class="specs-summary">
              <p><strong>SKU:</strong> <%= product.sku %></p>
              <p><strong>Category:</strong> <%= product.category.humanize %></p>
              <p><strong>Brand:</strong> <%= product.brand %></p>
              <p><strong>Model:</strong> <%= product.model %></p>
            </div>

            <div class="product-status">
              <span class="badge badge-<%= product.status %>"><%= product.status.humanize %></span>
              <span class="badge badge-<%= product.condition %>"><%= product.condition.humanize %></span>
            </div>

            <% if product.purchase_price %>
              <p class="price">Purchase Price: <%= format_currency(product.purchase_price) %></p>
            <% end %>

            <div class="actions">
              <%= link_to "View", product_path(product), class: "btn btn-sm" %>
              <%= link_to "Edit", edit_product_path(product), class: "btn btn-sm" %>
              <% if current_user.admin? %>
                <%= button_to "Delete", product_path(product), method: :delete,
                              data: { turbo_confirm: "Are you sure?" },
                              class: "btn btn-sm" %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="no-results">
        <p>No products found. <%= link_to "Add your first product", new_product_path %></p>
      </div>
    <% end %>
  </div>
</div>

<style>
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
.header-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.filters { background: var(--card); padding: 16px; border-radius: 10px; border: 1px solid var(--border); margin-bottom: 24px; }
.filter-form { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.filter-group { display: flex; gap: 10px; flex: 1; }
.form-control { padding: 9px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; }
.form-control:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(45,138,117,0.15); }
.products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 18px; }
.product-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; box-shadow: 0 3px 10px rgba(15,23,42,0.06); display: flex; flex-direction: column; }
.product-image { height: 200px; overflow: hidden; background: #f4f4f5; display: flex; align-items: center; justify-content: center; }
.product-image img { width: 100%; height: 100%; object-fit: cover; }
.no-image { color: #9ca3af; font-size: 14px; }
.product-info { padding: 14px; display: flex; flex-direction: column; gap: 8px; flex: 1; }
.product-info h3 { margin: 0; font-size: 17px; }
.product-info h3 a { color: var(--text); text-decoration: none; }
.product-info h3 a:hover { color: var(--accent); }
.specs-summary p { margin: 3px 0; font-size: 13px; color: #374151; }
.product-status { display: flex; gap: 6px; flex-wrap: wrap; }
.badge { display: inline-flex; align-items: center; padding: 5px 9px; border-radius: 999px; font-size: 12px; font-weight: 600; background: rgba(45,138,117,0.10); color: var(--accent); border: 1px solid rgba(45,138,117,0.25); }
.price { font-weight: 700; color: var(--text); margin: 6px 0; font-size: 14px; }
.actions { display: flex; gap: 6px; margin-top: auto; }
.no-results { text-align: center; padding: 32px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; }
</style>
