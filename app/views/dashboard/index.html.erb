<div class="dashboard">
  <div class="header">
    <h1>Ditronics Inventory Dashboard</h1>
    <% if current_user.admin? %>
      <%= link_to "Clear Cache", clear_cache_dashboard_index_path, method: :post, class: "btn btn-outline" %>
    <% end %>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon" style="background: #007bff;">üìä</div>
      <div class="stat-info">
        <h3><%= @stats[:total_products] %></h3>
        <p>Total Products</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: #28a745;">‚úÖ</div>
      <div class="stat-info">
        <h3><%= @stats[:available_products] %></h3>
        <p>Available</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: #6c757d;">üíº</div>
      <div class="stat-info">
        <h3><%= @stats[:sold_products] %></h3>
        <p>Sold Products</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: #ffc107;">üîß</div>
      <div class="stat-info">
        <h3><%= @stats[:in_service_products] %></h3>
        <p>In Service</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: #dc3545;">üóëÔ∏è</div>
      <div class="stat-info">
        <h3><%= @stats[:retired_products] %></h3>
        <p>Retired</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: #17a2b8;">üí∞</div>
      <div class="stat-info">
        <h3><%= @stats[:total_sales] %></h3>
        <p>Total Sales</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: #28a745;">üíµ</div>
      <div class="stat-info">
        <h3><%= number_to_currency(@stats[:total_revenue]) %></h3>
        <p>Total Revenue</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background: #6610f2;">üìà</div>
      <div class="stat-info">
        <h3><%= number_to_currency(@stats[:avg_sale_price] || 0) %></h3>
        <p>Avg Sale Price</p>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <!-- Recent Sales Section -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Recent Sales</h2>
        <%= link_to "View All ‚Üí", sales_path, class: "view-all-link" %>
      </div>
      
      <% if @recent_sales.any? %>
        <table class="recent-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Customer</th>
              <th>Date</th>
              <th>Price</th>
            </tr>
          </thead>
          <tbody>
            <% @recent_sales.each do |sale| %>
              <tr>
                <td><%= link_to sale.product.display_name, product_path(sale.product) %></td>
                <td><%= sale.sold_to %></td>
                <td><%= sale.sold_at.strftime("%b %d, %Y") %></td>
                <td class="price"><%= number_to_currency(sale.sale_price) %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="no-data">No sales yet.</p>
      <% end %>
    </div>

    <!-- Service Due Alerts -->
    <% if @service_due.any? %>
      <div class="dashboard-section alert-section">
        <div class="section-header">
          <h2>‚ö†Ô∏è Service Due Soon</h2>
        </div>
        
        <div class="alert-list">
          <% @service_due.each do |product| %>
            <div class="alert-item">
              <div class="alert-info">
                <strong><%= link_to product.display_name, product_path(product) %></strong>
                <span class="alert-date">Due: <%= product.next_service_due.strftime("%B %d, %Y") %></span>
              </div>
              <%= link_to "View", product_path(product), class: "btn btn-sm btn-warning" %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Recent Products -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Recently Added Products</h2>
        <%= link_to "View All ‚Üí", products_path, class: "view-all-link" %>
      </div>
      
      <div class="laptop-grid">
        <% @recent_products.each do |product| %>
          <div class="laptop-card-mini">
            <% if product.images.attached? %>
              <%= image_tag product.images.first.variant(resize_to_limit: [150, 100]), alt: product.display_name %>
            <% else %>
              <div class="no-image-mini">No Image</div>
            <% end %>
            <div class="laptop-info-mini">
              <h4><%= link_to product.display_name, product_path(product) %></h4>
              <p><%= product.brand %></p>
              <span class="badge badge-<%= product.status %>"><%= product.status.humanize %></span>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h2>Quick Actions</h2>
    <div class="action-buttons">
      <%= link_to "‚ûï Add Product", new_product_path, class: "btn btn-primary" %>
      <%= link_to "üíº Record Sale", new_sale_path, class: "btn btn-success" %>
      <%= link_to "üìã View Inventory", products_path, class: "btn btn-info" %>
      <%= link_to "üìä Sales History", sales_path, class: "btn btn-secondary" %>
    </div>
  </div>
</div>

<style>
.dashboard { max-width: 1400px; margin: 0 auto; padding: 20px; }
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
.stat-card { background: white; border-radius: 8px; padding: 20px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.stat-icon { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; }
.stat-info h3 { margin: 0; font-size: 32px; font-weight: bold; }
.stat-info p { margin: 5px 0 0 0; color: #6c757d; font-size: 14px; }
.dashboard-content { display: grid; gap: 30px; margin-bottom: 30px; }
.dashboard-section { background: white; border-radius: 8px; padding: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.alert-section { background: #fff3cd; border: 2px solid #ffc107; }
.section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.section-header h2 { margin: 0; font-size: 20px; }
.view-all-link { color: #007bff; text-decoration: none; font-size: 14px; }
.view-all-link:hover { text-decoration: underline; }
.recent-table { width: 100%; border-collapse: collapse; }
.recent-table thead { background: #f8f9fa; }
.recent-table th, .recent-table td { padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6; }
.recent-table a { color: #007bff; text-decoration: none; }
.recent-table a:hover { text-decoration: underline; }
.price { font-weight: bold; color: #28a745; }
.no-data { text-align: center; padding: 20px; color: #6c757d; }
.alert-list { display: flex; flex-direction: column; gap: 10px; }
.alert-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: white; border-radius: 4px; border-left: 4px solid #ffc107; }
.alert-info { display: flex; flex-direction: column; gap: 5px; }
.alert-info strong a { color: #333; text-decoration: none; }
.alert-info strong a:hover { color: #007bff; }
.alert-date { font-size: 13px; color: #856404; }
.laptop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
.laptop-card-mini { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; overflow: hidden; }
.laptop-card-mini img { width: 100%; height: 100px; object-fit: cover; }
.no-image-mini { height: 100px; display: flex; align-items: center; justify-content: center; background: #e9ecef; color: #6c757d; font-size: 12px; }
.laptop-info-mini { padding: 10px; }
.laptop-info-mini h4 { margin: 0 0 5px 0; font-size: 14px; }
.laptop-info-mini h4 a { color: #333; text-decoration: none; }
.laptop-info-mini h4 a:hover { color: #007bff; }
.laptop-info-mini p { margin: 0 0 8px 0; font-size: 12px; color: #6c757d; }
.quick-actions { background: white; border-radius: 8px; padding: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.quick-actions h2 { margin: 0 0 20px 0; font-size: 20px; }
.action-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
.badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
.badge-active { background: #28a745; color: white; }
.badge-sold { background: #6c757d; color: white; }
.badge-in_repair { background: #ffc107; color: black; }
.badge-retired { background: #dc3545; color: white; }
.btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; font-size: 14px; font-weight: 600; text-align: center; }
.btn-primary { background: #007bff; color: white; }
.btn-secondary { background: #6c757d; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-info { background: #17a2b8; color: white; }
.btn-warning { background: #ffc107; color: black; }
.btn-outline { background: white; color: #6c757d; border: 1px solid #6c757d; }
.btn-sm { padding: 5px 10px; font-size: 12px; }
</style>
