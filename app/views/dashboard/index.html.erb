<% content_for :page_heading do %>
  Dashboard Overview
<% end %>

<% content_for :page_subheading do %>
  Welcome back! Here's a snapshot of your inventory.
<% end %>

<% content_for :topbar_actions do %>
  <%= form_with url: products_path, method: :get, class: "top-search", local: true do |f| %>
    <span class="top-search__icon">⌕</span>
    <%= f.search_field :search, value: params[:search], placeholder: "Search for items...", class: "top-search__input" %>
  <% end %>

  <%= link_to "＋ Add New", new_product_path, class: "btn btn-primary" %>
  <% if current_user.admin? %>
    <%= link_to "Clear Cache", clear_cache_dashboard_index_path, method: :post, class: "btn btn-muted" %>
  <% end %>
<% end %>

<div class="dashboard">
  <section class="stats">
    <div class="stat-card">
      <div class="stat-card__label">Total Stock</div>
      <div class="stat-card__value"><%= @stats[:total_products] %></div>
    </div>
    <div class="stat-card">
      <div class="stat-card__label">Available Items</div>
      <div class="stat-card__value"><%= @stats[:available_products] %></div>
    </div>
    <div class="stat-card">
      <div class="stat-card__label">Total Sales</div>
      <div class="stat-card__value"><%= @stats[:total_sales] %></div>
    </div>
    <div class="stat-card">
      <div class="stat-card__label">Total Revenue</div>
      <div class="stat-card__value"><%= format_currency(@stats[:total_revenue]) %></div>
    </div>
  </section>

  <section class="panel">
    <div class="panel__header">
      <div>
        <h2 class="panel__title">Alerts</h2>
        <p class="panel__subtitle">Items that need attention soon.</p>
      </div>
    </div>

    <% if @service_due.any? %>
      <table class="table">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Due Date</th>
            <th>Status</th>
            <th class="text-right">Action</th>
          </tr>
        </thead>
        <tbody>
          <% @service_due.each do |product| %>
            <tr>
              <td class="cell-strong"><%= link_to product.display_name, product_path(product), class: "link" %></td>
              <td><%= product.next_service_due.strftime("%b %d, %Y") %></td>
              <td>
                <span class="pill pill--warn">Due Soon</span>
              </td>
              <td class="text-right"><%= link_to "View", product_path(product), class: "action" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="empty">No alerts right now.</p>
    <% end %>
  </section>
</div>

<style>
.dashboard { display: flex; flex-direction: column; gap: 16px; }

.stats { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 16px; }
.stat-card { background: #fff; border: 1px solid #e6edf5; border-radius: 12px; padding: 16px; }
.stat-card__label { font-size: 12px; color: #6b7a90; margin-bottom: 8px; font-weight: 600; }
.stat-card__value { font-size: 22px; font-weight: 800; color: #0f172a; }

.panel { background: #fff; border: 1px solid #e6edf5; border-radius: 12px; padding: 16px; }
.panel__header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; margin-bottom: 12px; }
.panel__title { font-size: 16px; font-weight: 800; color: #0f172a; margin: 0; }
.panel__subtitle { font-size: 13px; color: #6b7a90; margin-top: 6px; }

.table { width: 100%; border-collapse: collapse; }
.table th { text-align: left; padding: 12px 10px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.06em; color: #8aa0b8; border-bottom: 1px solid #edf2f7; }
.table td { padding: 14px 10px; border-bottom: 1px solid #edf2f7; font-size: 13px; color: #0f172a; }
.cell-strong { font-weight: 700; }
.text-right { text-align: right; }
.link { color: #2563eb; text-decoration: none; }
.link:hover { text-decoration: underline; }
.action { color: #2563eb; font-weight: 700; text-decoration: none; }
.action:hover { text-decoration: underline; }

.pill { display: inline-flex; align-items: center; padding: 6px 10px; border-radius: 999px; font-size: 11px; font-weight: 800; }
.pill--warn { background: #fff7ed; color: #c2410c; border: 1px solid #fed7aa; }

.empty { padding: 10px 0; color: #6b7a90; }

@media (max-width: 720px) {
  .stats { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
</style>

<style>
.top-search { position: relative; width: min(420px, 46vw); }
.top-search__icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #8aa0b8; font-size: 14px; pointer-events: none; }
.top-search__input { width: 100%; padding: 10px 12px 10px 32px; border-radius: 10px; border: 1px solid #e6edf5; background: #fff; font-size: 13px; outline: none; }
.top-search__input:focus { border-color: #c9daf5; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.10); }
</style>
